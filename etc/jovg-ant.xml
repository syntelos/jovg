<project name="jovg.ant" >

  <dirname property="jovg.etc" file="${ant.file.jovg.ant}"/>

  <fail message="Missing VG sources, property jovg.ri.include='${jovg.ri.include}'.">
    <condition>
      <not>
	<and>
          <resourceexists>
            <file file="${jovg.ri.include}/VG/openvg.h"/>
          </resourceexists>
          <resourceexists>
            <file file="${jovg.ri.include}/VG/vgu.h"/>
          </resourceexists>
          <resourceexists>
            <file file="${jovg.ri.include}/VG/vgplatform.h"/>
          </resourceexists>
	</and>
      </not>
    </condition>
  </fail>

  <property name="gluegen.root" value="${jovg.etc}/../../gluegen" />

  <fail message="Missing gluegen, property gluegen.root='${gluegen.root}'.">
    <condition>
      <not>
        <resourceexists>
          <file file="${gluegen.root}"/>
        </resourceexists>
      </not>
    </condition>
  </fail>

  <import file="${gluegen.root}/make/gluegen-cpptasks.xml" />

  <condition property="rootrel.build" value="build">
    <not>
      <isset property="rootrel.build"/>
    </not>
  </condition>

  <condition property="gluegen.jar" value="${gluegen.root}/${rootrel.build}/gluegen.jar">
    <not>
      <isset property="gluegen.jar"/>
    </not>
  </condition>

  <condition property="ant.jar" value="/usr/share/java/ant.jar">
    <not>
      <isset property="ant.jar"/>
    </not>
  </condition>

  <condition property="antlr.jar" value="${gluegen.root}/${rootrel.build}/antlr.jar">
    <not>
      <isset property="antlr.jar"/>
    </not>
  </condition>

  <path id="jovg.etc.classpath">
    <pathelement location="${jovg.etc}/bin" />
  </path>

  <taskdef name="uncomment-copy" classname="com.jogamp.jovg.ant.CSourceUncomment" classpathref="jovg.etc.classpath" />

  <path id="gluegen.classpath">
    <pathelement location="${gluegen.jar}" />
    <pathelement location="${antlr.jar}" />
  </path>

  <taskdef name="gluegen" classname="com.jogamp.gluegen.ant.GlueGenTask" classpathref="gluegen.classpath" />

  <path id="test.through.classpath">
    <pathelement path="${toString:gluegen.classpath}" />
    <pathelement location="${toString:jovg.etc.classpath}" />
  </path>

  <macrodef name="test-through">
    <attribute name="src"/>
    <sequential>
      <java classpathref="test.through.classpath" classname="com.jogamp.jovg.cgram.TestThrough" fork="true">
	<arg value="@{src}"/>
      </java>
    </sequential>
  </macrodef>

  <macrodef name="test-gluegen">
    <attribute name="inc"/>
    <attribute name="src"/>
    <sequential>
      <java classpathref="gluegen.classpath" classname="com.jogamp.gluegen.GlueGen" fork="true">
	<arg value="@{inc}"/>
	<arg value="@{src}"/>
      </java>
    </sequential>
  </macrodef>

</project>
